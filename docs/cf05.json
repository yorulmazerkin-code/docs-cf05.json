{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://yorulmazerkin-code.github.io/docs-cf05.json/cf05.schema.json",
  "title": "CF05 Bundle Schema (FINAL v1.1.3+)",
  "description": "A single bundled JSON Schema that contains CF05 canonical entity, alias, crosswalk, name rules, and resolution events definitions. Use top-level properties to validate data dumps per table.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "schema_version": { "type": "string", "const": "1.1.3+" },
    "generated_at": { "type": "string", "format": "date-time" },
    "canonical_entity_index": { "type": "array", "items": { "$ref": "#/$defs/canonical_entity" } },
    "alias_index": { "type": "array", "items": { "$ref": "#/$defs/alias_entry" } },
    "crosswalk_index": { "type": "array", "items": { "$ref": "#/$defs/crosswalk_entry" } },
    "name_rules": { "type": "array", "items": { "$ref": "#/$defs/name_rule" } },
    "resolution_events": { "type": "array", "items": { "$ref": "#/$defs/resolution_event" } }
  },
  "required": ["schema_version","canonical_entity_index","crosswalk_index"],
  "$defs": {
    "entity_type": { "type": "string", "enum": ["team","player","coach","referee","competition","stadium"] },
    "tier": { "type": "string", "enum": ["official","primary_stats","media","forum","odds"] },
    "canonical_entity": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "canonical_entity_id": { "type": "string", "pattern": "^[A-Z0-9._:-]{3,64}$" },
        "entity_type": { "$ref": "#/$defs/entity_type" },
        "canonical_name": { "type": "string", "minLength": 1 },
        "country_code": { "type": "string", "pattern": "^[A-Z]{2}$" },
        "league_code": { "type": ["string","null"] },
        "team_code": { "type": ["string","null"] },
        "status": { "type": "string", "enum": ["active","retired","inactive","unknown"] },
        "created_at": { "type": "string", "format": "date-time" },
        "updated_at": { "type": "string", "format": "date-time" },
        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "source_id": { "type": "string" },
              "source_tier": { "$ref": "#/$defs/tier" },
              "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
              "last_seen": { "type": "string", "format": "date-time" }
            },
            "required": ["source_id","source_tier"]
          }
        }
      },
      "required": ["canonical_entity_id","entity_type","canonical_name","status","created_at","updated_at"]
    },
    "alias_entry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "alias_id": { "type": "string", "pattern": "^[A-Z0-9._:-]{3,64}$" },
        "canonical_entity_id": { "type": "string" },
        "entity_type": { "$ref": "#/$defs/entity_type" },
        "alias": { "type": "string", "minLength": 1 },
        "normalized": { "type": "string" },
        "language": { "type": "string", "pattern": "^[a-z]{2}(-[A-Z]{2})?$" },
        "translit_system": { "type": ["string","null"] },
        "valid_from": { "type": ["string","null"], "format": "date-time" },
        "valid_to": { "type": ["string","null"], "format": "date-time" },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "required": ["alias_id","canonical_entity_id","entity_type","alias","normalized","language","confidence"]
    },
    "crosswalk_entry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "crosswalk_id": { "type": "string", "pattern": "^[A-Z0-9._:-]{3,64}$" },
        "source_id": { "type": "string" },
        "source_entity_id": { "type": "string" },
        "canonical_entity_id": { "type": "string" },
        "entity_type": { "$ref": "#/$defs/entity_type" },
        "priority": { "type": "integer", "minimum": 0, "maximum": 9 },
        "reliability": { "type": "number", "minimum": 0, "maximum": 1 },
        "valid_from": { "type": ["string","null"], "format": "date-time" },
        "valid_to": { "type": ["string","null"], "format": "date-time" }
      },
      "required": ["crosswalk_id","source_id","source_entity_id","canonical_entity_id","entity_type"]
    },
    "name_rule": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "rule_id": { "type": "string", "pattern": "^[A-Z0-9._:-]{3,64}$" },
        "target_type": { "$ref": "#/$defs/entity_type" },
        "locale": { "type": "string", "pattern": "^[a-z]{2}(-[A-Z]{2})?$" },
        "pattern": { "type": "string", "description": "Regex or wildcard" },
        "replace": { "type": ["string","null"] },
        "methods": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["strip_accents","to_lower","collapse_spaces","romanize_tr","romanize_es","romanize_generic","trim","remove_punct"]
          }
        },
        "weight": { "type": "number", "minimum": 0, "maximum": 1 },
        "enabled": { "type": "boolean" },
        "notes": { "type": ["string","null"] }
      },
      "required": ["rule_id","target_type","pattern","methods","enabled"]
    },
    "resolution_event": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "event_id": { "type": "string", "pattern": "^[A-Z0-9._:-]{3,64}$" },
        "run_id": { "type": "string" },
        "match_uid": { "type": ["string","null"] },
        "input_token": { "type": "string" },
        "candidate_set": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "canonical_entity_id": { "type": "string" },
              "score": { "type": "number", "minimum": 0, "maximum": 1 },
              "method": { "type": "string", "enum": ["exact","fuzzy","rule","crosswalk","manual"] }
            },
            "required": ["canonical_entity_id","score","method"]
          }
        },
        "method": { "type": "string", "enum": ["exact","fuzzy","rule","crosswalk","manual"] },
        "decision": { "type": "string", "enum": ["accept","reject","escalate"] },
        "decided_entity_id": { "type": ["string","null"] },
        "score": { "type": "number", "minimum": 0, "maximum": 1 },
        "reviewer": { "type": ["string","null"] },
        "trace_id": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      },
      "required": ["event_id","run_id","input_token","method","decision","trace_id","timestamp"]
    }
  }
}
